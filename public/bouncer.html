<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Regret Bouncy Ball</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
      user-select: none;
    }

    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle, rgba(0,0,0,1) 0%, rgba(15,15,40,1) 100%);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #game-area {
      position: relative;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .blurred-border {
      position: absolute;
      background: rgba(0, 0, 50, 0.3);
      backdrop-filter: blur(10px);
    }

    .blurred-border.top, .blurred-border.bottom {
      left: 0;
      right: 0;
      height: 50px;
    }

    .blurred-border.left, .blurred-border.right {
      top: 0;
      bottom: 0;
      width: 50px;
    }

    .blurred-border.top { top: 0; }
    .blurred-border.bottom { bottom: 0; }
    .blurred-border.left { left: 0; }
    .blurred-border.right { right: 0; }

    .circle {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 0, 0, 0.8);
      text-align: center;
      line-height: 40px;
      font-size: 16px;
      color: #fff;
      box-shadow: 0 0 50px rgba(255, 0, 0, 1);
      transition: transform 0.1s ease-out;
      cursor: pointer;
    }

    #aspect-ratio-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #cheat-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: #fff;
      padding: 20px;
      border-radius: 10px;
      font-size: 24px;
      text-align: center;
      display: none;
    }

    .alias-label {
      position: absolute;
      top: -40px;
      left: -10px;
      width: 100px;
      text-align: center;
      color: #ffd700;
      font-size: 16px;
      animation: spark 1s infinite;
      filter: drop-shadow(0 0 10px #ffd700);
    }

    @keyframes spark {
      0%, 100% { filter: drop-shadow(0 0 10px #ffd700); }
      50% { filter: drop-shadow(0 0 20px #ffd700); }
    }

    .lightning {
      position: absolute;
      width: 2px;
      background: linear-gradient(to top, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0));
      filter: drop-shadow(0 0 5px #fff);
      animation: shoot 0.3s forwards;
    }

    @keyframes shoot {
      0% { height: 0; }
      100% { height: 100px; }
    }

    .mist {
      position: absolute;
      width: 150px;
      height: 150px;
      pointer-events: none;
      will-change: transform, opacity;
    }

    .ember {
      position: absolute;
      background-color: orange;
      border-radius: 50%;
      opacity: 0.8;
      pointer-events: none; /* Prevent interaction with embers */
      animation: fade 1s forwards;
    }

    @keyframes fade {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(0.5); }
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background-color: white;
      border-radius: 50%;
      opacity: 0.8;
    }

    .star.twinkle {
      animation: twinkle 1.5s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.2; }
    }
    
  </style>
</head>
<body>
  <div id="game-container">
    <div id="game-area">
      <div class="blurred-border top"></div>
      <div class="blurred-border bottom"></div>
      <div class="blurred-border left"></div>
      <div class="blurred-border right"></div>
    </div>
    <button id="aspect-ratio-toggle">Toggle 16:9 / 4:3</button>
  </div>
  <div id="cheat-message">Stop trying to Cheat, you fucking Weiner.</div>

  <script>
  const gameContainer = document.getElementById('game-container');
  const gameArea = document.getElementById('game-area');
  const cheatMessage = document.getElementById('cheat-message');
  const aspectRatioToggle = document.getElementById('aspect-ratio-toggle');

  // Define base dimensions
  const baseWidth = 1600;
  const baseHeight = 900;
  let scale = 1;
  let isWidescreen = true;

  // Minimum allowed dimensions
  const minWidth = 955;
  const minHeight = 542;

  // Add audio element
  const popSound = new Audio('../images/pop.mp3');
  popSound.volume = 0.5; // Adjust volume as needed

  // Prompt for player name
  const playerName = prompt("Enter your player name:", "Space Walker") || "Space Walker";

  // Game constants
  const emberThreshold = 3;
  const releaseMultiplier = 0.15;
  const mistSlowdown = 0.995;
  const energyDecay = 0.9998;
  const minBounciness = 0.7;
  const maxBounciness = 1.0;

  // Game variables
  let isDragging = false;
  let lastMouseX = 0;
  let lastMouseY = 0;
  let dragStartX = 0;
  let dragStartY = 0;
  let bounceCount = 0;
  let lastSoundTime = 0;

  // Player object
  const player = {
    alias: playerName,
    x: baseWidth / 2,
    y: baseHeight / 2,
    vx: 0,
    vy: 0,
    radius: 20,  // Reduced default size
    energy: 0
  };

  // Create player element
  const playerElement = document.createElement('div');
  playerElement.className = 'circle';

  const aliasLabel = document.createElement('div');
  aliasLabel.className = 'alias-label';
  aliasLabel.textContent = player.alias;

  playerElement.appendChild(aliasLabel);

  // Create bounce score display
  const scoreDisplay = document.createElement('div');
  scoreDisplay.style.position = 'absolute';
  scoreDisplay.style.top = '10px';
  scoreDisplay.style.left = '10px';
  scoreDisplay.style.color = 'white';
  scoreDisplay.style.fontSize = '24px';
  scoreDisplay.textContent = 'Bounces: 0';

  function updateGameArea() {
    const containerWidth = gameContainer.clientWidth;
    const containerHeight = gameContainer.clientHeight;

    if (containerWidth < minWidth || containerHeight < minHeight) {
      showCheatMessage();
      return;
    }

    hideCheatMessage();

    const containerAspect = containerWidth / containerHeight;
    const gameAspect = isWidescreen ? 16 / 9 : 4 / 3;

    if (containerAspect > gameAspect) {
      scale = containerHeight / baseHeight;
      gameArea.style.width = `${containerHeight * gameAspect}px`;
      gameArea.style.height = `${containerHeight}px`;
    } else {
      scale = containerWidth / baseWidth;
      gameArea.style.width = `${containerWidth}px`;
      gameArea.style.height = `${containerWidth / gameAspect}px`;
    }

    gameArea.style.fontSize = `${16 * scale}px`;

    // Update player position and size
    updatePlayerElement();
  }
    
  function showCheatMessage() {
    cheatMessage.style.display = 'block';
    gameArea.style.display = 'none';
    bounceCount = 0;
    scoreDisplay.textContent = 'Bounces: 0';
  }

  function hideCheatMessage() {
    cheatMessage.style.display = 'none';
    gameArea.style.display = 'block';
  }

  function updatePlayerElement() {
    playerElement.style.width = `${player.radius * 2 * scale}px`;
    playerElement.style.height = `${player.radius * 2 * scale}px`;
    playerElement.style.left = `${(player.x - player.radius) * scale}px`;
    playerElement.style.top = `${(player.y - player.radius) * scale}px`;
  }

  const velocityThreshold = 0.1; // Adjust this value as needed
  
  function updatePosition() {
      if (cheatMessage.style.display === 'block') return;
  
      if (!isDragging) {
          let bounced = false;
  
          // Check horizontal borders
          const nextX = player.x + player.vx;
          if (nextX - player.radius <= 50 || nextX + player.radius >= baseWidth - 50) {
              const bounciness = minBounciness + (maxBounciness - minBounciness) * player.energy;
              player.vx *= -bounciness;
              bounced = true;
          }
  
          // Check vertical borders
          const nextY = player.y + player.vy;
          if (nextY - player.radius <= 50 || nextY + player.radius >= baseHeight - 50) {
              const bounciness = minBounciness + (maxBounciness - minBounciness) * player.energy;
              player.vy *= -bounciness;
              bounced = true;
          }
  
          if (bounced) {
              createLightning(player.x * scale, player.y * scale);
              impactShake();
              incrementBounceCount();
              playPopSound();
          }
  
          // Update position after checking for bounces
          player.x += player.vx;
          player.y += player.vy;
  
          // Ensure the ball stays within bounds
          player.x = Math.max(50 + player.radius, Math.min(baseWidth - 50 - player.radius, player.x));
          player.y = Math.max(50 + player.radius, Math.min(baseHeight - 50 - player.radius, player.y));
  
          const speed = Math.sqrt(player.vx * player.vx + player.vy * player.vy);
  
          // Stop the ball if the speed is below the threshold
          if (speed < velocityThreshold) {
              player.vx = 0;
              player.vy = 0;
              player.energy = 0;
              return; // Stop further processing to prevent unnecessary bounce checks
          }
  
          if (speed > emberThreshold) {
              createEmberTrail(player.x * scale, player.y * scale, player.vx, player.vy);
          }
  
          interactWithMist(player.x * scale, player.y * scale);
  
          // Apply energy-based slowdown
          player.energy *= energyDecay;
          player.vx *= 0.999;
          player.vy *= 0.999;
      }
  
      updatePlayerElement();
  
      // Visual feedback for high energy
      const energyScale = 1 + player.energy * 0.3;
      const energyRotation = player.energy * 360;
      playerElement.style.transform = `scale(${energyScale * scale}) rotate(${energyRotation}deg)`;
  
      requestAnimationFrame(updatePosition);
  }

  function incrementBounceCount() {
    bounceCount++;
    scoreDisplay.textContent = `Bounces: ${bounceCount}`;
  }

  function playPopSound() {
      const currentTime = Date.now();
      if (currentTime - lastSoundTime > 50) {
        popSound.currentTime = 0;
        popSound.play();
      }
      lastSoundTime = currentTime;
    }

    // Mouse event listeners
    gameContainer.addEventListener('mousedown', (event) => {
      const rect = gameArea.getBoundingClientRect();
      const x = (event.clientX - rect.left) / scale;
      const y = (event.clientY - rect.top) / scale;
      const dx = x - player.x;
      const dy = y - player.y;
      if (dx * dx + dy * dy <= player.radius * player.radius) {
        isDragging = true;
        lastMouseX = dragStartX = x;
        lastMouseY = dragStartY = y;
        playerElement.style.transform = `scale(${0.8 * scale})`;
      }
    });

    gameContainer.addEventListener('mousemove', (event) => {
      if (isDragging) {
        const rect = gameArea.getBoundingClientRect();
        const x = (event.clientX - rect.left) / scale;
        const y = (event.clientY - rect.top) / scale;
        const dx = x - lastMouseX;
        const dy = y - lastMouseY;
        player.x += dx;
        player.y += dy;
        lastMouseX = x;
        lastMouseY = y;
      }
    });

    gameContainer.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        playerElement.style.transform = `scale(${scale})`;
        const releaseX = lastMouseX - dragStartX;
        const releaseY = lastMouseY - dragStartY;
        const releaseMagnitude = Math.sqrt(releaseX * releaseX + releaseY * releaseY);
        player.vx = releaseX * releaseMultiplier;
        player.vy = releaseY * releaseMultiplier;
        player.energy = Math.min(releaseMagnitude / 200, 1);
        bounceCount = 0;
        scoreDisplay.textContent = 'Bounces: 0';
        
        if (player.energy > 0.6) {
          createPowerThrowEffect();
        }
      }
    });

    function createPowerThrowEffect() {
     const powerRing = document.createElement('div');
      powerRing.style.position = 'absolute';
      powerRing.style.left = `${player.x - player.radius * 2}px`;
      powerRing.style.top = `${player.y - player.radius * 2}px`;
      powerRing.style.width = `${player.radius * 4}px`;
      powerRing.style.height = `${player.radius * 4}px`;
      powerRing.style.borderRadius = '50%';
      powerRing.style.border = '4px solid white';
      powerRing.style.opacity = '0.8';
      powerRing.style.transition = 'all 0.5s ease-out';

      gameArea.appendChild(powerRing);

      setTimeout(() => {
        powerRing.style.transform = 'scale(3)';
        powerRing.style.opacity = '0';
      }, 50);

      setTimeout(() => {
        gameArea.removeChild(powerRing);
      }, 550);
    }


  
    // Create lightning effect shooting from the ball
    function createLightning(x, y) {
      for (let i = 0; i < 5; i++) {
        const lightning = document.createElement('div');
        lightning.className = 'lightning';
        lightning.style.left = `${x}px`;
        lightning.style.top = `${y}px`;
        lightning.style.transform = `rotate(${Math.random() * 360}deg)`;
  
        gameArea.appendChild(lightning);
  
        setTimeout(() => {
          gameArea.removeChild(lightning);
        }, 300);
      }
    }
  
    // Create mist elements in the background
    function createMist() {
      gameArea.querySelectorAll('.mist').forEach(mist => mist.remove());
      const mistCount = Math.min(20, Math.floor(20 * scale));
      for (let i = 0; i < 20; i++) {
        const mist = document.createElement('div');
        mist.className = 'mist';
        mist.style.left = `${Math.random() * baseWidth * scale}px`;
        mist.style.top = `${Math.random() * baseHeight * scale}px`;
        mist.style.transform = `scale(${(Math.random() * 0.5 + 0.5) * scale})`;
        mist.style.opacity = Math.random() * 0.5 + 0.2;
    
        const hue = Math.random() * 60 + 180;
        mist.style.background = `radial-gradient(circle, hsla(${hue}, 100%, 70%, 0.3) 0%, hsla(${hue}, 100%, 50%, 0) 70%)`;
    
        gameArea.appendChild(mist);
        animateMist(mist);
      }
    }
    
    function animateMist(mistElement) {
      const duration = Math.random() * 10000 + 5000;
      const keyframes = [
        { transform: `scale(${Math.random() * 0.5 + 0.5}) rotate(0deg)`, opacity: Math.random() * 0.5 + 0.2 },
        { transform: `scale(${Math.random() * 0.5 + 0.8}) rotate(180deg)`, opacity: Math.random() * 0.5 + 0.4 },
        { transform: `scale(${Math.random() * 0.5 + 0.5}) rotate(360deg)`, opacity: Math.random() * 0.5 + 0.2 }
      ];
    
      mistElement.animate(keyframes, {
        duration: duration,
        iterations: Infinity,
        easing: 'ease-in-out',
        direction: 'alternate'
      });
    }
  
    // Create star elements in the background
    function createStars() {
      gameArea.querySelectorAll('.star').forEach(star => star.remove());
      const starCount = Math.min(100, Math.floor(100 * scale));
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = `${Math.random() * baseWidth * scale}px`;
        star.style.top = `${Math.random() * baseHeight * scale}px`;
  
        if (Math.random() > 0.5) {
          star.classList.add('twinkle');
        }
  
        gameArea.appendChild(star);
      }
    }
  
    // Interact with mist
    function interactWithMist(x, y) {
      const mists = document.querySelectorAll('.mist');
      mists.forEach(mist => {
        const dx = mist.offsetLeft + 75 - x;
        const dy = mist.offsetTop + 75 - y;
        const distance = Math.sqrt(dx * dx + dy * dy);
    
        if (distance < 150) {
          const angle = Math.atan2(dy, dx);
          const force = (150 - distance) / 150;
          const moveX = Math.cos(angle) * force * 50;
          const moveY = Math.sin(angle) * force * 50;
    
          mist.animate([
            { transform: `translate(${moveX}px, ${moveY}px) scale(${1 + force})` },
            { transform: 'translate(0, 0) scale(1)' }
          ], {
            duration: 1000,
            easing: 'ease-out'
          });
        }
      });
    }
  
    // Create ember trail effect
    function createEmberTrail(x, y, vx, vy) {
      const ember = document.createElement('div');
      ember.className = 'ember';
      const size = Math.random() * 5 + 3;
      ember.style.width = `${size}px`;
      ember.style.height = `${size}px`;
      
      const angle = Math.atan2(vy, vx);
      const offsetX = Math.cos(angle + Math.PI) * player.radius;
      const offsetY = Math.sin(angle + Math.PI) * player.radius;
  
      ember.style.left = `${x + offsetX - size / 2}px`;
      ember.style.top = `${y + offsetY - size / 2}px`;
  
      gameArea.appendChild(ember);
  
      setTimeout(() => {
        gameArea.removeChild(ember);
      }, 1000 + Math.random() * 500);
    }
  
    // Impact shake effect
    function impactShake() {
      const currentTransform = playerElement.style.transform;
      const bounceSequence = [
        { transform: `${currentTransform} scale(0.8, 1.2)`, offset: 0 },
        { transform: `${currentTransform} scale(1.2, 0.8)`, offset: 0.3 },
        { transform: `${currentTransform} scale(0.9, 1.1)`, offset: 0.5 },
        { transform: `${currentTransform} scale(1.1, 0.9)`, offset: 0.7 },
        { transform: currentTransform, offset: 1 }
      ];
    
      playerElement.animate(bounceSequence, {
        duration: 300,
        easing: 'ease-in-out'
      });
    }

    // Add aspect ratio toggle functionality
    aspectRatioToggle.addEventListener('click', () => {
      isWidescreen = !isWidescreen;
      updateGameArea();
      createMist();
      createStars();
    });

    // Initialize the game
    function initGame() {
      updateGameArea();
      gameArea.appendChild(playerElement);
      gameArea.appendChild(scoreDisplay);
      createMist();
      createStars();
      updatePosition();
    }

    // Add window resize event listener
    window.addEventListener('resize', () => {
      updateGameArea();
      createMist();
      createStars();
    });
    
    // Start the game
    initGame();
  </script>
</body>
</html>
